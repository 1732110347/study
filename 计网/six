应用层协议
精确定义不同主机中的多个应用进程之间的通信规则。
包括：
应用进程交换的报文类型，如请求报文和响应报文。
各种报文类型的语法，如报文中的各个字段及其详细描述。
字段的语义，即包含在字段中的信息的含义。
进程何时、如何发送报文，以及对报文进行响应的规则


6.1.1  域名系统概述
域名系统 DNS (Domain Name System) ：
互联网使用的命名系统。
用来把人们使用的机器名字（域名）转换为 IP 地址。
为互联网的各种网络应用提供了核心服务。

域名采用层次树状结构的命名方法：www.myschool.edu。
DNS 是一个联机分布式数据库系统，采用客户服务器方式。
域名到 IP 地址的解析是由若干个域名服务器程序共同完成。
域名服务器程序在专设的结点上运行，运行该程序的机器称为域名服务器。 


6.1.2   互联网的域名结构
命名方法：层次树状结构方法。
任何一个连接在互联网上的主机或路由器，都有一个唯一的层次结构的名字，即域名 (domain name)。
域 (domain)：
名字空间中一个可被管理的划分。
可以划分为子域，而子域还可继续划分为子域的子域，这样就形成了顶级域、二级域、三级域，等等。

域名结构：层次结构。由标号 (label) 序列组成，各标号之间用点（.）隔开，各标号分别代表不同级别的域名。

每一个标号不超过 63 个字符
不区分大小写字母
完整域名总共不超过 255 个字符
mail.cctv.com 
三级域名 . 二级域名 . 顶级域名
（级别最低）            （级别最高）

全球顶级域名 TLD (Top Level Domain)
国家顶级域名 nTLD
采用 ISO 3166的规定
又常记为 ccTLD

通用顶级域名 gTLD
com，net，org，edu，gov 等

基础结构域名(infrastructure domain)
只有一个：arpa

新顶级域名
（New gTLD）
任何公司、机构都有权向ICANN 申请新的顶级域

我国把二级域名划分为“类别域名”和“行政区域名”两大类。


6.1.3  域名服务器
实现域名系统使用分布在各地的域名服务器（DNS 服务器）。
一个服务器所负责管辖的（或有权限的）范围叫做区 (zone)。
各单位根据具体情况来划分自己管辖范围的区。但在一个区中的所有节点必须是能够连通的。
每一个区设置相应的权限域名服务器，用来保存该区中的所有主机的域名到 IP 地址的映射。

DNS 服务器的管辖范围不是以“域”为单位，而是以“区”为单位。


根域名服务器
com 域名服务器  顶级域名服务器
abc.com     权限域名服务器
域名服务器


根据所起的作用，分为四种类型：
根域名服务器 
顶级域名服务器 
权限域名服务器 
本地域名服务器 

1. 根域名服务器
最高层次，最为重要。
所有根域名服务器都知道所有的顶级域名服务器的域名和 IP 地址。
不管是哪一个本地域名服务器，若要对互联网上任何一个域名进行解析，只要自己无法解析，就首先求助于根域名服务器。
若所有的根域名服务器都瘫痪了，整个互联网中的 DNS 系统就无法工作了。

根域名服务器共有 13 套装置，构成 13 组根域名服务器。
根域名服务器总共只有 13 个不同 IP 地址的域名，但并非仅由13台机器所组成。
根域名服务器采用任播 (anycast) 技术，当DNS 客户向某个根域名服务器发出查询报文时，路由器能找到离这个 DNS 客户最近的一个根域名服务器。


注意：
根域名服务器并不直接把域名转换成 IP 地址（根域名服务器也没有存放这种信息），而是告诉本地域名服务器下一步应当找哪一个顶级域名服务器进行查询。


2. 顶级域名服务器
顶级域名服务器（即 TLD 服务器）负责管理在该顶级域名服务器注册的所有二级域名。
当收到 DNS 查询请求时，就给出相应的回答（可能是最后的结果，也可能是下一步应当找的域名服务器的 IP 地址）。

3. 权限域名服务器
负责一个区（zone）的域名服务器。
当一个权限域名服务器还不能给出最后的查询回答时，就会告诉发出查询请求的 DNS 客户，下一步应当找哪一个权限域名服务器。 

4. 本地域名服务器
当一个主机发出 DNS 查询请求时，该查询请求报文就发送给本地域名服务器。
每一个互联网服务提供者 ISP 或一个大学，都可以拥有一个本地域名服务器。
当所要查询的主机也属于同一个本地 ISP 时，该本地域名服务器立即就能将所查询的主机名转换为它的 IP 地址，而不需要再去询问其他的域名服务器。
本地域名服务器有时也称为默认域名服务器。

提高域名服务器的可靠性
DNS 域名服务器都把数据复制到几个域名服务器来保存，其中的一个是主域名服务器，其他的是辅助域名服务器。
当主域名服务器出故障时，辅助域名服务器可以保证 DNS 的查询工作不会中断。
主域名服务器定期把数据复制到辅助域名服务器中，而更改数据只能在主域名服务器中进行，保证了数据的一致性。


域名的解析过程
递归查询
通常，主机向本地域名服务器查询时使用。
若不知道，就以 DNS 客户的身份，向其他根域名服务器继续发出查询请求报文。

迭代查询
本地域名服务器向根域名服务器查询时使用。
要么给出所要查询的 IP 地址，要么告诉下一个要查询的域名服务器的 IP 地址。
本地域名服务器继续后续查询

高速缓存
称为高速缓存域名服务器。
存放最近用过的名字以及从何处获得名字映射信息的记录。
作用：大大减轻根域名服务器的负荷，使 DNS 查询请求和回答报文的数量大为减少。 
域名服务器应为每项内容设置计时器，并处理超过合理时间的项。
当权限域名服务器回答一个查询请求时，在响应中指明绑定有效存在的时间值。增加此时间值可减少网络开销，而减少此时间值可提高域名转换的准确性。 



6.2.1  FTP 概述
文件传送协议 FTP (File Transfer Protocol) 是互联网上使用得最广泛的文件传送协议。
提供交互式的访问，允许客户指明文件的类型与格式，并允许文件具有存取权限。
屏蔽了各计算机系统的细节，因而适合于在异构网络中任意计算机之间传送文件。
是文件共享协议的一个大类。 

文件共享协议
文件传送协议：FTP， TFTP 等。
复制整个文件。对文件副本进行访问。
若要存取一个文件，就必须先获得一个本地文件副本。
若要修改文件，只能对文件副本进行修改，然后再将修改后的文件副本传回到原节点。
联机访问 (on-line access) 协议：NFS 等。
允许同时对一个文件进行存取。
远地共享文件访问，如同对本地文件的访问一样。
透明存取，不需要对该应用程序作明显的改动。
由操作系统负责。


6.2.2  FTP 的基本工作原理
网络环境下复制文件的复杂性：
计算机存储数据的格式不同。
文件的目录结构和文件命名的规定不同。
对于相同的文件存取功能，操作系统使用的命令不同。
访问控制方法不同。 

FTP 特点
只提供文件传送的一些基本服务，它使用 TCP 可靠的运输服务。
主要功能：减少或消除在不同操作系统下处理文件的不兼容性。
使用客户服务器方式。
一个 FTP 服务器进程可同时为多个客户进程提供服务。
FTP 的服务器进程由两大部分组成：
一个主进程，负责接受新的请求；
若干个从属进程，负责处理单个请求。


FTP 主进程的工作步骤
打开熟知端口（端口号为 21），使客户进程能够连接上。
等待客户进程发出连接请求。
启动从属进程来处理客户进程发来的请求。从属进程对客户进程的请求处理完毕后即终止，但从属进程在运行期间根据需要还可能创建其他一些子进程。
回到等待状态，继续接受其他客户进程发来的请求。主进程与从属进程的处理是并发地进行。 

NFS 采用的思路
FTP 并非对所有的数据传输都是最佳的：仅能访问副本。
NFS 允许应用进程打开一个远地文件，并能在该文件的某一个特定的位置上开始读写数据。
NFS 可使用户只复制一个大文件中的一个很小的片段，而不需要复制整个大文件。
NFS 在网络上传送的只是少量的修改数据。 


6.2.3  简单文件传送协议 TFTP

TFTP (Trivial File Transfer Protocol) 是一个很小且易于实现的文件传送协议。
使用客户服务器方式和使用 UDP 数据报，因此 TFTP 需要有自己的差错改正措施。
只支持文件传输，不支持交互。
没有庞大的命令集，没有列目录的功能，也不能对用户进行身份鉴别。
优点：（1）可用于 UDP 环境；（2）代码所占的内存较小


6.3  远程终端协议 TELNET


6.4.1  万维网概述
万维网 WWW (World Wide Web) 并非某种特殊的计算机网络。
万维网是一个大规模的、联机式的信息储藏所。
万维网用链接的方法能非常方便地从互联网上的一个站点访问另一个站点，从而主动地按需获取丰富的信息。
这种访问方式称为“链接”。

万维网是分布式超媒体 (hypermedia) 系统
是超文本 (hypertext) 系统的扩充。
超文本：由多个信息源链接成。是万维网的基础。
超媒体与超文本的区别：文档内容不同。
超文本文档仅包含文本信息。
超媒体文档还包含其他信息，如图形、图像、声音、动画，甚至活动视频图像等。
分布式系统
信息分布在整个互联网上。每台主机上的文档都独立进行管理


万维网的工作方式
以客户服务器方式工作。
客户程序：浏览器。
服务器程序：在万维网文档所驻留的主机上运行。这个计算机也称为万维网服务器。
客户程序向服务器程序发出请求，服务器程序向客户程序送回客户所要的万维网文档。
在一个客户程序主窗口上显示出的万维网文档称为页面 (page)。


万维网必须解决的问题
(1) 怎样标志分布在整个互联网上的万维网文档？ 
使用统一资源定位符 URL (Uniform Resource Locator) 。
使每一个文档在整个互联网的范围内具有唯一的标识符 URL。
(2) 用什么协议来实现万维网上的各种链接？ 
使用超文本传送协议 HTTP (HyperText Transfer Protocol)。
HTTP 是一个应用层协议，使用 TCP 连接进行可靠的传送。
(3) 怎样使不同作者创作的不同风格的万维网文档都能在互联网上的各种主机上显示出来，同时使用户清楚地知道在什么地方存在着链接？
使用超文本标记语言 HTML (HyperText Markup Language) 。
(4) 怎样使用户能够很方便地找到所需的信息？ 
使用各种的搜索工具（即搜索引擎）。 


6.4.2  统一资源定位符 URL
是对互联网上资源的位置和访问方法的一种简洁表示。
给资源的位置提供一种抽象的识别方法，并用这种方法给资源定位。
实际上就是在互联网上的资源的地址。
显然，互联网上的所有资源，都有一个唯一确定的URL。
资源：指在互联网上可以被访问的任何对象，包括文件目录、文件、文档、图像、声音等，以及与互联网相连的任何形式的数据。
URL 相当于一个文件名在网络范围的扩展。因此，URL 是与互联网相连的机器上的任何可访问对象的一个指针。


1. URL 的格式
由以冒号（:）隔开的两大部分组成，对字符大写或小写没有要求。
一般形式：

<协议>://<主机>:<端口>/<路径> 
ftp —— 文件传送协议 FTP
http —— 超文本传送协议 HTTP
News —— USENET 新闻

://规定的格式

存放资源的主机在互联网中的域名，也可以是用点分十进制的 IP 地址。

端口号。省略时使用默认端口号

资源所在目录位置。区分大小写。省略时使用所定义的默认路径。后面可能还有一些选项。

2. 使用 HTTP 的 URL


6.4.3  超文本传送协议 HTTP
HTTP 是面向事务的 (transaction-oriented) 应用层协议。
使用 TCP 连接进行可靠的传送。
定义了浏览器与万维网服务器通信的格式和规则。
是万维网上能够可靠地交换文件（包括文本、声音、图像等各种多媒体文件）的重要基础。
HTTP 不仅传送完成超文本跳转所必需的信息，而且也传送任何可从互联网上得到的信息，如文本、超文本、声音和图像等。

HTTP 使用了面向连接的 TCP 作为运输层协议，保证了数据的可靠传输。
HTTP 协议本身也是无连接的。
HTTP 是无状态的 (stateless)，简化了服务器的设计，使服务器更容易支持大量并发的 HTTP 请求。 


请求一个万维网文档所需的时间
所需的时间 >= 
   RTT（三报文握手建立 TCP 连接） 
+ RTT（请求和接收文档）
+ 文档的传输时间
= 2 RTT +文档的传输时间


协议 HTTP/1.0 的主要缺点
每请求一个文档就要有两倍 RTT 的开销。
客户和服务器每一次建立新的 TCP 连接都要分配缓存和变量。
这种非持续连接使服务器的负担很重。

协议 HTTP/1.1 使用持续连接
持续连接（persistent connection）：服务器在发送响应后仍然在一段时间内保持这条连接（不释放），使同一个客户（浏览器）和该服务器可以继续在这条连接上传送后续的 HTTP 请求报文和响应报文。
只要文档都在同一个服务器上，就可以继续使用该 TCP 连接。
两种工作方式：
非流水线方式 (without pipelining)
流水线方式 (with pipelining)。

协议 HTTP/2
是协议 HTTP/1.1 的升级版本。
服务器可以并行发回响应（使用同一个 TCP 连接）。
允许客户复用 TCP 连接进行多个请求。
把所有的报文都划分为许多较小的二进制编码的帧，并采用了新的压缩算法，不发送重复的首部字段，大大减小了首部的开销，提高了传输效率。
向后兼容。


2. 代理服务器
代理服务器 (proxy server) 又称为万维网高速缓存 (Web cache)，它代表浏览器发出 HTTP 请求。
使用高速缓存可减少访问互联网服务器的时延。

3. HTTP 的报文结构
两类报文：
请求报文：从客户向服务器的请求。
响应报文：从服务器到客户的回答。
由于 HTTP 是面向正文的 (text-oriented)，因此报文中每一个字段的值都是一些 ASCII 码串，每个字段的长度都是不确定的。
三个组成部分：
开始行：用于区分是请求报文还是响应报文。
首部行：说明浏览器、服务器或报文主体的一些信息。可以有多行，也可以不使用。
实体主体：请求报文中一般不用，响应报文中也可能没有该字段。


6.4.4  万维网的文档
在一个客户程序主窗口上显示出的万维网文档称为页面 (page)。
页面制作的标准语言：HTML。
分为：
静态万维网文档。内容不会改变。简单。
动态万维网文档。文档的内容由应用程序动态创建。
活动万维网文档。由浏览器端改变文档的内容。

1. 超文本标记语言 HTML
超文本标记语言 HTML (HyperText Markup Language) 是一种制作万维网页面的标准语言，它消除了不同计算机之间信息交流的障碍，是万维网的重要基础 [RFC 2854]。
注意：HTML 不是应用层的协议，它只是万维网浏览器使用的一种语言。

HTML 定义了许多用于排版的命令（即标签）。
HTML 把各种标签嵌入到万维网的页面中，构成了所谓的 HTML 文档。
HTML 文档是一种可以用任何文本编辑器创建的 ASCII 码文件。
HTML 文档的后缀：.html 或 .htm。 

2. 动态万维网文档
静态文档：该文档创作完毕后就存放在万维网服务器中，在被用户浏览的过程中，内容不会改变。 
动态文档：文档的内容是在浏览器访问万维网服务器时才由应用程序动态创建。
动态文档和静态文档之间的主要差别体现在服务器端：文档内容的生成方法不同。从浏览器的角度看，这两种文档并没有区别。 

万维网服务器功能的扩充
(1) 增加一个应用程序：处理浏览器发来的数据，并创建动态文档。
(2) 增加一个机制：使万维网服务器把浏览器发来的数据传送给这个应用程序，然后万维网服务器能够解释这个应用程序的输出，并向浏览器返回 HTML 文档。


通用网关接口 CGI (Common Gateway Interface) ：定义动态文档应如何创建，输入数据应如何提供给应用程序，以及输出结果应如何使用的一种标准。
通用：CGI 标准所定义的规则对其他任何语言都是通用的。
网关：CGI 程序的作用像网关。
接口：有一些已定义好的变量和调用等可供其他 CGI 程序使用


3. 活动万维网文档

活动文档 (active document) 技术：把屏幕连续更新的工作转移给浏览器端。
每当浏览器请求一个活动文档时，服务器就返回一段程序副本在浏览器端运行。
活动文档程序可与用户直接交互，并可连续地改变屏幕的显示。
由于活动文档技术不需要服务器的连续更新传送，对网络带宽的要求也不会太高。 


6.4.5  万维网的信息检索系统
在万维网中用来进行搜索的程序叫做搜索引擎 (search engine)。


6.5.1  电子邮件概述
电子邮件 (e-mail)：指使用电子设备交换的邮件及其方法。
优点：使用方便，传递迅速，费用低廉，可以传送多种类型的信息（包括：文字信息，声音和图像等）。
重要标准：
简单邮件发送协议：SMTP
互联网文本报文格式
通用互联网邮件扩充 MIME
邮件读取协议：POP3 和 IMAP


电子邮件系统的组成：三个主要构件
用户代理，邮件服务器，以及邮件发送和读取协议。


用户代理 UA (User Agent)
用户与电子邮件系统的接口。又被称为电子邮件客户端软件。
基本功能：撰写、显示、处理、通信

邮件服务器 (Mail Server)
又被称为邮件传输代理。
功能：发送和接收邮件，同时还要向发信人报告邮件传送的情况。
按照客户服务器方式工作

邮件发送和读取协议
邮件发送和读取使用不同的协议。
简单邮件发送协议 SMTP：用于在用户代理向邮件服务器 或 邮件服务器之间发送邮件。
邮局协议 POP3：用于用户代理从邮件服务器读取邮件。

邮件服务器必须能够同时充当客户和服务器。
SMTP 和 POP3（或 IMAP）都使用 TCP 连接可靠地传送邮件。


TCP/IP 体系的电子邮件系统规定电子邮件地址的格式如下
收件人邮箱名@邮箱所在主机的域名


6.5.2  简单邮件传送协议 SMTP
SMTP 规定了在两个相互通信的 SMTP 进程之间交换信息的方法。
SMTP 使用客户服务器方式。
SMTP 基于 TCP 实现客户与服务器的通信。


SMTP 是一个基于文本的 （即 ASCII 码） 的协议。 
SMTP 客户与服务器之间采用命令-响应方式进行交互。


SMTP 通信的三个阶段
连接建立：连接是在发送主机的 SMTP 客户和接收主机的 SMTP 服务器之间建立的。SMTP 不使用中间的邮件服务器。   
邮件传送
连接释放：邮件发送完毕后，SMTP 应释放 TCP 连接。 



6.5.4  邮件读取协议 POP3 和 IMAP
两个常用的邮件读取协议：
POP3：邮局协议 (Post Office Protocol) 第3个版本 
IMAP：网际报文存取协议 (Internet Message Access Protocol)

POP3 协议
POP3 使用客户服务器方式。
POP3 基于 TCP 实现客户与服务器的通信。

POP3 支持用户鉴别。
POP3 服务器删除被用户读取了的邮件。


IMAP 协议
IMAP 使用客户服务器方式。
IMAP 基于 TCP 实现客户与服务器的通信。
IMAP 是一个联机协议。

连接后只下载邮件首部（部分下载）。
用户直接在 IMAP 服务器上创建和管理文件夹。
用户可以搜索邮件内容。
用户可以在不同的地方使用不同的计算机随时上网阅读和处理自己的邮件。
允许收信人只读取邮件中的某一个部分。
缺点：要想查阅邮件，必须先联网。



6.6  动态主机配置协议 DHCP
在协议软件中，给协议参数赋值的动作叫做协议配置。
一个协议软件在使用之前必须是已正确配置的。
具体的配置信息取决于协议栈。
连接到互联网的计算机的协议软件需要正确配置的参数包括：
IP 地址
子网掩码
默认路由器的 IP 地址
域名服务器的 IP 地址

动态主机配置协议 DHCP (Dynamic Host Configuration Protocol) 提供了即插即用连网 (plug-and-play networking) 的机制，允许一台计算机加入网络和获取 IP 地址，而不用手工配置。
DHCP 给运行服务器软件、且位置固定的计算机指派一个永久地址，给运行客户端软件的计算机分配一个临时地址。


DHCP 使用客户服务器方式
需要 IP 地址的主机在启动时就向 DHCP 服务器广播发送发现报文
（DHCPDISCOVER），这时该主机就成为 DHCP 客户。
本地网络上所有主机都能收到此广播报文，但只有 DHCP 服务器才回答此广播报文。
DHCP 服务器先在其数据库中查找该计算机的配置信息。若找到，则返回找到的信息。若找不到，则从服务器的 IP 地址池 (address pool) 中取一个地址分配给该计算机。DHCP服务器的回答报文叫做提供报文（DHCPOFFER）。

DHCP 使用客户服务器方式，采用请求/应答方式工作。
DHCP 基于 UDP 工作，DHCP 服务器运行在 67 号端口， DHCP客户运行在 68 号端口。


DHCP 中继代理 (relay agent) 
问题：每个网络上都需要有 DHCP 服务器吗？
答案：不需要，因为会使 DHCP 服务器的数量太多。
问题：若没有 DHCP 服务器，如何自动获得地址？
解决：每一个网络至少有一个 DHCP 中继代理，它配置了 DHCP 服务器的 IP 地址信息。



6.7.1  网络管理的基本概念
网络管理包括对硬件、软件和人力的使用、综合与协调，以便对网络资源进行监视、测试、配置、分析、评价和控制，这样就能以合理的价格满足网络的一些需求，如实时运行性能，服务质量等。
网络管理常简称为网管。


网络管理的五大功能
故障管理：故障检测、隔离和纠正。
配置管理：初始化网络、并配置网络。
计费管理：记录网络资源的使用。
性能管理：估价系统资源的运行状况及通信效率等。
网络安全管理：对授权机制、访问控制、加密和加密关键字的管理。


网络管理协议简称为网管协议。
网络管理协议是管理程序和代理程序之间进行通信的规则。
网络管理员利用网络管理协议，通过管理站对网络中的被管设备进行管理。 
注意：网管协议本身不管理网络。


简单网络管理协议 SNMP (Simple Network Management Protocol) 中的管理程序和代理程序按客户服务器方式工作。
管理程序运行 SNMP 客户程序，向某个代理程序发出请求 (或命令)。
代理程序运行 SNMP 服务器程序，返回响应 (或执行某个动作)。
在网管系统中，往往是一个（或少数几个）客户程序与很多的服务器程序进行交互。


SNMP 的网络管理由三个部分组成：
SNMP 本身
管理信息结构 SMI (Structure of Management Information)
管理信息库 MIB (Management Information Base)。 





























